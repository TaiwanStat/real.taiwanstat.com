!function r(i,a,c){function l(o,t){if(!a[o]){if(!i[o]){var e="function"==typeof require&&require;if(!t&&e)return e(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var n=a[o]={exports:{}};i[o][0].call(n.exports,function(t){var e=i[o][1][t];return l(e||t)},n,n.exports,r,i,a,c)}return a[o].exports}for(var s="function"==typeof require&&require,t=0;t<c.length;t++)l(c[t]);return l}({1:[function(r,t,e){!function(){var c;d3Initialize=r("./index");var t,e=L.control();window.getLocation=function(){if(navigator.geolocation)return navigator.geolocation.getCurrentPosition(n)},window.resetView=function(){c.setView(new L.LatLng(24,121),7)},window.toogleInfo=function(){t?$(".main-info").hide():$(".main-info").show();t=!t};var l=L.icon({iconUrl:"./images/yellow.png",iconSize:[35,45],iconAnchor:[17,42],popupAnchor:[0,-35]}),s=L.icon({iconUrl:"./images/brown.png",iconSize:[35,45],iconAnchor:[17,42],popupAnchor:[0,-35]});function d(t,e){for(var o in e)if(e[o].SiteName==t)return e[o]}function u(t){return t<=35?{disc:"空氣品質良好",color:"green"}:t<=41?{disc:"空氣品質普通",color:"yellow"}:t<=53?{disc:"對敏感性族群不健康",color:"orange"}:t<=64?{disc:"空氣品質不良",color:"red"}:t<=70?{disc:"空氣品質非常不良",color:"red"}:{disc:"空氣品質屬有害",color:"purple"}}$(document).ready(function(){!function(){c=new L.Map("map"),url="https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",attrib='&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>';var t=new L.TileLayer(url,{minZoom:1,maxZoom:16,attribution:attrib});c.setView(new L.LatLng(24,121),7),t.addTo(c),e.addTo(c),o.addTo(c)}(),d3.csv("./data/site.csv",function(e){d3.json("https://www.taiwanstat.com/airs/latest/",function(t){!function(t,e){var o=t[0].PublishTime;for(var n in t){t[n].PublishTime>=o&&($(".updateAt").text("更新時間："+t[n].PublishTime+"（每小時更新）"),o=t[n].PublishTime);var r,i=u(t[n].PM2_5);r="yellow"==i.color?l:"brown"==i.color?s:L.AwesomeMarkers.icon({prefix:"fa",icon:"map-marker",markerColor:i.color});var a=d(t[n].SiteName,e);if(a)L.marker([a.TWD97Lat,a.TWD97Lon],{icon:r,opacity:.9}).addTo(c).bindPopup("<strong>測站名稱："+t[n].SiteName+'</strong><br/><span class="'+i.color+'">PM2.5 空污指標：'+i.disc+"</span><br/>PM2.5："+t[n].PM2_5+"（μg/m3）<br/>PM10："+t[n].PM10+"（μg/m3）<br/>PSI："+t[n].PSI+"<br/>測站類型："+a.SiteType+"<br/>地址："+a.SiteAddress)}d3Initialize(c,e)}(t,e)})})}),e.onAdd=function(t){return this._div=L.DomUtil.create("div","info"),this._div.innerHTML='<h4 class="">格狀區塊：表示該區域內最近的測站</h4>',this._div};var o=L.control({position:"bottomright"});function n(t){c.setView(new L.LatLng(t.coords.latitude,t.coords.longitude),10)}o.onAdd=function(t){for(var e=L.DomUtil.create("div","info legend"),o=["#5F2828","#E062C8","#F52305","#F7931C","yellow","#7FB73A"],n=["有害","非常不良","不良","接近不良","普通","良好"],r=0;r<n.length;r++)e.innerHTML+='<i style="background:'+o[r]+'"></i>'+n[r]+"<br/>";return e}}()},{"./index":2}],2:[function(t,d,e){!function(){var e,o,n,r;d.exports=function(t,e){n=t,a=e,l(),t.on("viewreset moveend",function(t){t&&"viewreset"==t.type&&d3.select("#overlay").remove(),setTimeout(function(){l()},0)})};var i,a=null;var c=function(){d3.selectAll(".selected").classed("selected",!1);var t=d3.select(this),e=t.datum();lastSelectedPoint=e,t.classed("selected",!0)};function l(){d3.select("#overlay").remove(),r=n.getBounds();var t=n.latLngToLayerPoint(r.getNorthWest());n.latLngToLayerPoint(r.getSouthEast()),d3.set(),r.pad(.4);o=d3.geo.mercator().center([122.079531,23.978567]).scale(10200),d3.geo.path().projection(o),e=d3.select(n.getPanes().overlayPane).append("svg").attr("id","overlay").attr("class","leaflet-zoom-hide").style("width",n.getSize().x+"px").style("height",n.getSize().y+"px").style("margin-left",t.x+"px").style("margin-top",t.y+"px"),i=e.append("g").attr("transform","translate("+-t.x+","+-t.y+")"),s()}function s(){var o=[];a.forEach(function(t){var e=new L.LatLng(+t.TWD97Lat,+t.TWD97Lon);point=n.latLngToLayerPoint(e),o.push(point)});var t=i.attr("class","points").selectAll("g").data(o).enter().append("g").attr("class","point"),e=d3.geom.voronoi().x(function(t){return t.x}).y(function(t){return t.y});e(o).forEach(function(t){t.point.cell=t});t.append("path").attr("class","point-cell").on("click",c).attr("d",function(t){if(t.cell)return"M"+t.cell.join("L")+"Z";e([t]).forEach(function(t){return"M"+t.join("L")+"Z"})})}}()},{}]},{},[1]);