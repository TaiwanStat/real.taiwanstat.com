!function t(e,o,n){function r(a,c){if(!o[a]){if(!e[a]){var l="function"==typeof require&&require;if(!c&&l)return l(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+a+"'")}var s=o[a]={exports:{}};e[a][0].call(s.exports,function(t){var o=e[a][1][t];return r(o?o:t)},s,s.exports,t,e,o,n)}return o[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(t,e,o){!function(){function e(t,e){var r=t[0].PublishTime;for(var i in t){t[i].PublishTime>=r&&($(".updateAt").text("更新時間："+t[i].PublishTime+"（每小時更新）"),r=t[i].PublishTime);var a,c=n(t[i].PM2_5);a="yellow"==c.color?p:"brown"==c.color?f:L.AwesomeMarkers.icon({prefix:"fa",icon:"map-marker",markerColor:c.color});var l=o(t[i].SiteName,e),d=L.marker([l.TWD97Lat,l.TWD97Lon],{icon:a,opacity:.9}).addTo(s);d.bindPopup("<strong>測站名稱："+t[i].SiteName+'</strong><br/><span class="'+c.color+'">PM2.5 空污指標：'+c.disc+"</span><br/>PM2.5："+t[i].PM2_5+"（μg/m3）<br/>PM10："+t[i].PM10+"（μg/m3）<br/>PSI："+t[i].PSI+"<br/>測站類型："+l.SiteType+"<br/>地址："+l.SiteAddress)}d3Initialize(s,e)}function o(t,e){for(var o in e)if(e[o].SiteName==t)return e[o]}function n(t){return 35>=t?{disc:"空氣品質良好",color:"green"}:41>=t?{disc:"空氣品質普通",color:"yellow"}:53>=t?{disc:"對敏感性族群不健康",color:"orange"}:64>=t?{disc:"空氣品質不良",color:"red"}:70>=t?{disc:"空氣品質非常不良",color:"red"}:{disc:"空氣品質屬有害",color:"purple"}}function r(){s=new L.Map("map"),url="https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",attrib='&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>';var t=new L.TileLayer(url,{minZoom:1,maxZoom:16,attribution:attrib});s.setView(new L.LatLng(24,121),7),t.addTo(s),u.addTo(s),g.addTo(s)}function i(){return navigator.geolocation?navigator.geolocation.getCurrentPosition(a):void 0}function a(t){s.setView(new L.LatLng(t.coords.latitude,t.coords.longitude),10)}function c(){s.setView(new L.LatLng(24,121),7)}function l(){d?$(".main-info").hide():$(".main-info").show(),d=!d}d3Initialize=t("./index");var s,d,u=L.control();window.getLocation=i,window.resetView=c,window.toogleInfo=l;var p=L.icon({iconUrl:"./images/yellow.png",iconSize:[35,45],iconAnchor:[17,42],popupAnchor:[0,-35]}),f=L.icon({iconUrl:"./images/brown.png",iconSize:[35,45],iconAnchor:[17,42],popupAnchor:[0,-35]});$(document).ready(function(){r(),d3.csv("./data/site.csv",function(t){var o="https://www.taiwanstat.com/airs/latest/";d3.json(o,function(o){e(o,t)})})}),u.onAdd=function(t){return this._div=L.DomUtil.create("div","info"),this._div.innerHTML='<h4 class="">格狀區塊：表示該區域內最近的測站</h4>',this._div};var g=L.control({position:"bottomright"});g.onAdd=function(t){for(var e=L.DomUtil.create("div","info legend"),o=["#5F2828","#E062C8","#F52305","#F7931C","yellow","#7FB73A"],n=["有害","非常不良","不良","接近不良","普通","良好"],r=0;r<n.length;r++)e.innerHTML+='<i style="background:'+o[r]+'"></i>'+n[r]+"<br/>";return e}}()},{"./index":2}],2:[function(t,e,o){!function(){function t(t,e){c=t,d=e,o(),t.on("viewreset moveend",function(t){t&&"viewreset"==t.type&&d3.select("#overlay").remove(),setTimeout(function(){o()},0)})}function o(){d3.select("#overlay").remove(),l=c.getBounds();{var t=c.latLngToLayerPoint(l.getNorthWest());c.latLngToLayerPoint(l.getSouthEast()),d3.set(),l.pad(.4)}i=d3.geo.mercator().center([122.079531,23.978567]).scale(10200),a=d3.geo.path().projection(i),r=d3.select(c.getPanes().overlayPane).append("svg").attr("id","overlay").attr("class","leaflet-zoom-hide").style("width",c.getSize().x+"px").style("height",c.getSize().y+"px").style("margin-left",t.x+"px").style("margin-top",t.y+"px"),s=r.append("g").attr("transform","translate("+-t.x+","+-t.y+")"),n()}function n(){var t=[];d.forEach(function(e){var o=new L.LatLng(+e.TWD97Lat,+e.TWD97Lon);point=c.latLngToLayerPoint(o),t.push(point)});var e=s.attr("class","points").selectAll("g").data(t).enter().append("g").attr("class","point"),o=d3.geom.voronoi().x(function(t){return t.x}).y(function(t){return t.y});o(t).forEach(function(t){t.point.cell=t});var n=function(t){return t.cell?"M"+t.cell.join("L")+"Z":void o([t]).forEach(function(t){return"M"+t.join("L")+"Z"})};e.append("path").attr("class","point-cell").on("click",u).attr("d",n)}e.exports=t;var r,i,a,c,l,s,d=null,u=function(){d3.selectAll(".selected").classed("selected",!1);var t=d3.select(this),e=t.datum();lastSelectedPoint=e,t.classed("selected",!0)}}()},{}]},{},[1]);